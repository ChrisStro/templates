services:
  dashboard:
    environment:
      - AUTH_CLIENT_SECRET=
      - AUTH_AUDIENCE=$NETBIRD_AUTH_CLIENT_ID
      - AUTH_AUTHORITY=https://login.microsoftonline.com/$AZ_TENANT_ID/v2.0

configs:
  management.json:
    content: |
      {
        "Stuns": [
            {
                "Proto": "udp",
                "URI": "stun:$TURN_DOMAIN:3478",
                "Username": "",
                "Password": null
            }
        ],
        "Relay": {
          "Addresses": ["rel://$NETBIRD_DOMAIN:$RELAY_PORT"],
          "CredentialsTTL": "24h",
          "Secret": "$RELAY_SECRET"
        },
        "TURNConfig": {
            "Turns": [
                {
                    "Proto": "udp",
                    "URI": "turn:$TURN_DOMAIN:3478",
                    "Username": "$TURN_USER",
                    "Password": "$TURN_PASSWORD"
                }
            ],
            "CredentialsTTL": "12h",
            "Secret": "secret",
            "TimeBasedCredentials": false
        },
        "Signal": {
            "Proto": "https",
            "URI": "$NETBIRD_DOMAIN:443",
            "Username": "",
            "Password": null
        },
        "Datadir": "/var/lib/netbird/",
        "DataStoreEncryptionKey": "$NETBIRD_DATASTORE_ENC_KEY",
        "StoreConfig": {
            "Engine": "$NETBIRD_STORE_CONFIG_ENGINE"
        },
        "HttpConfig": {
            "AuthAudience": "$NETBIRD_AUTH_CLIENT_ID",
            "AuthUserIDClaim": "$NETBIRD_AUTH_USER_ID_CLAIM",
            "IdpSignKeyRefreshEnabled": $NETBIRD_MGMT_IDP_SIGNKEY_REFRESH,
            "OIDCConfigEndpoint":"https://login.microsoftonline.com/$AZ_TENANT_ID/v2.0/.well-known/openid-configuration"
        },
        "IdpManagerConfig": {
            "ManagerType": "$NETBIRD_MGMT_IDP",
            "ClientConfig": {
                "Issuer": "https://login.microsoftonline.com/$AZ_TENANT_ID/v2.0",
                "TokenEndpoint": "https://login.microsoftonline.com/$AZ_TENANT_ID/oauth2/v2.0/token",
                "ClientID": "$NETBIRD_AUTH_CLIENT_ID",
                "ClientSecret": "$NETBIRD_AUTH_CLIENT_SECRET",
                "GrantType": "client_credentials"
            },
            "ExtraConfig": {
                "GraphApiEndpoint":"https://graph.microsoft.com/v1.0",
                "ObjectId":"$AZ_OBJECT_ID"
            },
            "Auth0ClientCredentials": null,
            "AzureClientCredentials": null,
            "KeycloakClientCredentials": null,
            "ZitadelClientCredentials": null
        },
        "DeviceAuthorizationFlow": {
            "Provider": "hosted",
            "ProviderConfig": {
              "Audience": "$NETBIRD_AUTH_CLIENT_ID",
              "AuthorizationEndpoint": "",
              "ClientID": "$NETBIRD_AUTH_CLIENT_ID",
              "ClientSecret": "$NETBIRD_AUTH_CLIENT_SECRET",
              "Scope": "openid",
              "UseIDToken": false,
              "RedirectURLs": null
            }
        },
        "PKCEAuthorizationFlow": {
            "ProviderConfig": {
                "Audience": "$NETBIRD_AUTH_CLIENT_ID",
                "ClientID": "$NETBIRD_AUTH_CLIENT_ID",
                "ClientSecret": "$NETBIRD_AUTH_CLIENT_SECRET",
                "Domain": "",
                "Scope": "$NETBIRD_AUTH_SUPPORTED_SCOPES",
                "RedirectURLs": [
                  "http://localhost:53000",
                  "https://$NETBIRD_DOMAIN/auth",
                  "https://$NETBIRD_DOMAIN/silent-auth"
                ],
                "UseIDToken": false
            }
        }
      }